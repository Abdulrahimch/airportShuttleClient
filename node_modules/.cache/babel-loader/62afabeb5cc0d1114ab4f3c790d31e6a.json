{"ast":null,"code":"import _regeneratorRuntime from\"/home/cisco/airportShuttleDeploy/airportShuttleV2/client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/cisco/airportShuttleDeploy/airportShuttleV2/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/cisco/airportShuttleDeploy/airportShuttleV2/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState,useContext,createContext,useEffect,useCallback}from'react';import{useHistory}from'react-router-dom';import loginWithCookies from'../helpers/APICalls/loginWithCookies';import logoutAPI from'../helpers/APICalls/logout';import{jsx as _jsx}from\"react/jsx-runtime\";export var AuthContext=/*#__PURE__*/createContext({loggedInUser:undefined,updateLoginContext:function updateLoginContext(){return null;},logout:function logout(){return null;}});export var AuthProvider=function AuthProvider(_ref){var children=_ref.children;var _useState=useState(),_useState2=_slicedToArray(_useState,2),loggedInUser=_useState2[0],setLoggedInUser=_useState2[1];var history=useHistory();var updateLoginContext=useCallback(function(data){setLoggedInUser(data.user);data.user.role==='client'?history.push('/reservation'):history.push('/agency-home');},[history]);var logout=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return logoutAPI().then(function(){history.push('/login');setLoggedInUser(null);}).catch(function(error){return console.error(error);});case 2:case\"end\":return _context.stop();}}},_callee);})),[history]);useEffect(function(){var checkLoginWithCookies=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return loginWithCookies().then(function(data){if(data.success){updateLoginContext(data.success);data.success.user.role==='client'?history.push('/reservation'):history.push('/agency-home');}else{setLoggedInUser(null);history.push('/login');}});case 2:case\"end\":return _context2.stop();}}},_callee2);}));return function checkLoginWithCookies(){return _ref3.apply(this,arguments);};}();checkLoginWithCookies();},[updateLoginContext,history]);return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{loggedInUser:loggedInUser,updateLoginContext:updateLoginContext,logout:logout},children:children});};export function useAuth(){return useContext(AuthContext);}","map":{"version":3,"sources":["/home/cisco/airportShuttleDeploy/airportShuttleV2/client/src/context/useAuthContext.tsx"],"names":["useState","useContext","createContext","useEffect","useCallback","useHistory","loginWithCookies","logoutAPI","AuthContext","loggedInUser","undefined","updateLoginContext","logout","AuthProvider","children","setLoggedInUser","history","data","user","role","push","then","catch","error","console","checkLoginWithCookies","success","useAuth"],"mappings":"8ZAAA,OAASA,QAAT,CAAmBC,UAAnB,CAA+BC,aAA/B,CAAiEC,SAAjE,CAA4EC,WAA5E,KAA+F,OAA/F,CACA,OAASC,UAAT,KAA2B,kBAA3B,CAGA,MAAOC,CAAAA,gBAAP,KAA6B,sCAA7B,CACA,MAAOC,CAAAA,SAAP,KAAsB,4BAAtB,C,2CAQA,MAAO,IAAMC,CAAAA,WAAW,cAAGN,aAAa,CAAe,CACrDO,YAAY,CAAEC,SADuC,CAErDC,kBAAkB,CAAE,oCAAM,KAAN,EAFiC,CAGrDC,MAAM,CAAE,wBAAM,KAAN,EAH6C,CAAf,CAAjC,CAMP,MAAO,IAAMC,CAAAA,YAA+B,CAAG,QAAlCA,CAAAA,YAAkC,MAA+B,IAA5BC,CAAAA,QAA4B,MAA5BA,QAA4B,CAC5E,cAAwCd,QAAQ,EAAhD,wCAAOS,YAAP,eAAqBM,eAArB,eACA,GAAMC,CAAAA,OAAO,CAAGX,UAAU,EAA1B,CAEA,GAAMM,CAAAA,kBAAkB,CAAGP,WAAW,CACpC,SAACa,IAAD,CAA8B,CAC5BF,eAAe,CAACE,IAAI,CAACC,IAAN,CAAf,CACAD,IAAI,CAACC,IAAL,CAAUC,IAAV,GAAmB,QAAnB,CAA8BH,OAAO,CAACI,IAAR,CAAa,cAAb,CAA9B,CAA6DJ,OAAO,CAACI,IAAR,CAAa,cAAb,CAA7D,CACD,CAJmC,CAKpC,CAACJ,OAAD,CALoC,CAAtC,CAQA,GAAMJ,CAAAA,MAAM,CAAGR,WAAW,sEAAC,yJACnBG,CAAAA,SAAS,GACZc,IADG,CACE,UAAM,CACVL,OAAO,CAACI,IAAR,CAAa,QAAb,EACAL,eAAe,CAAC,IAAD,CAAf,CACD,CAJG,EAKHO,KALG,CAKG,SAACC,KAAD,QAAgBC,CAAAA,OAAO,CAACD,KAAR,CAAcA,KAAd,CAAhB,EALH,CADmB,uDAAD,GAOvB,CAACP,OAAD,CAPuB,CAA1B,CASAb,SAAS,CAAC,UAAM,CACd,GAAMsB,CAAAA,qBAAqB,2FAAG,+JACtBnB,CAAAA,gBAAgB,GAAGe,IAAnB,CAAwB,SAACJ,IAAD,CAAuB,CACnD,GAAIA,IAAI,CAACS,OAAT,CAAkB,CAChBf,kBAAkB,CAACM,IAAI,CAACS,OAAN,CAAlB,CACAT,IAAI,CAACS,OAAL,CAAaR,IAAb,CAAkBC,IAAlB,GAA2B,QAA3B,CAAsCH,OAAO,CAACI,IAAR,CAAa,cAAb,CAAtC,CAAqEJ,OAAO,CAACI,IAAR,CAAa,cAAb,CAArE,CACD,CAHD,IAGO,CACLL,eAAe,CAAC,IAAD,CAAf,CACAC,OAAO,CAACI,IAAR,CAAa,QAAb,EACD,CACF,CARK,CADsB,yDAAH,kBAArBK,CAAAA,qBAAqB,2CAA3B,CAWAA,qBAAqB,GACtB,CAbQ,CAaN,CAACd,kBAAD,CAAqBK,OAArB,CAbM,CAAT,CAeA,mBAAO,KAAC,WAAD,CAAa,QAAb,EAAsB,KAAK,CAAE,CAAEP,YAAY,CAAZA,YAAF,CAAgBE,kBAAkB,CAAlBA,kBAAhB,CAAoCC,MAAM,CAANA,MAApC,CAA7B,UAA4EE,QAA5E,EAAP,CACD,CArCM,CAuCP,MAAO,SAASa,CAAAA,OAAT,EAAiC,CACtC,MAAO1B,CAAAA,UAAU,CAACO,WAAD,CAAjB,CACD","sourcesContent":["import { useState, useContext, createContext, FunctionComponent, useEffect, useCallback } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { AuthApiData, AuthApiDataSuccess } from '../interface/AuthApiData';\nimport { User } from '../interface/User';\nimport loginWithCookies from '../helpers/APICalls/loginWithCookies';\nimport logoutAPI from '../helpers/APICalls/logout';\n\ninterface IAuthContext {\n  loggedInUser: User | null | undefined;\n  updateLoginContext: (data: AuthApiDataSuccess) => void;\n  logout: () => void;\n}\n\nexport const AuthContext = createContext<IAuthContext>({\n  loggedInUser: undefined,\n  updateLoginContext: () => null,\n  logout: () => null,\n});\n\nexport const AuthProvider: FunctionComponent = ({ children }): JSX.Element => {\n  const [loggedInUser, setLoggedInUser] = useState<User | null | undefined>();\n  const history = useHistory();\n\n  const updateLoginContext = useCallback(\n    (data: AuthApiDataSuccess) => {\n      setLoggedInUser(data.user);\n      data.user.role === 'client' ? history.push('/reservation') : history.push('/agency-home');\n    },\n    [history],\n  );\n\n  const logout = useCallback(async () => {\n    await logoutAPI()\n      .then(() => {\n        history.push('/login');\n        setLoggedInUser(null);\n      })\n      .catch((error: any) => console.error(error));\n  }, [history]);\n\n  useEffect(() => {\n    const checkLoginWithCookies = async () => {\n      await loginWithCookies().then((data: AuthApiData) => {\n        if (data.success) {\n          updateLoginContext(data.success);\n          data.success.user.role === 'client' ? history.push('/reservation') : history.push('/agency-home');\n        } else {\n          setLoggedInUser(null);\n          history.push('/login');\n        }\n      });\n    };\n    checkLoginWithCookies();\n  }, [updateLoginContext, history]);\n\n  return <AuthContext.Provider value={{ loggedInUser, updateLoginContext, logout }}>{children}</AuthContext.Provider>;\n};\n\nexport function useAuth(): IAuthContext {\n  return useContext(AuthContext);\n}\n"]},"metadata":{},"sourceType":"module"}