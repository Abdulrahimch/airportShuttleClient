{"ast":null,"code":"var _jsxFileName = \"/home/cisco/airport-shuttle-v2/airportShuttleV2/client/src/pages/ClientPayment/ClientPayment.tsx\",\n    _s = $RefreshSig$();\n\nimport { Box } from '@material-ui/core';\nimport { useEffect, useState, useRef } from 'react';\nimport DataTable from '../../components/DataTable/DataTable';\nimport { useLanguage } from '../../context/useLanguageContext';\nimport { format } from 'date-fns';\nimport { detailsEngColumns, detailsTurksihColumns } from '../../utils/dictionary';\nimport Search from '../../components/Search/Search';\nimport { getMyDetailsStat } from '../../helpers/APICalls/reservation';\nimport { useAuth } from '../../context/useAuthContext';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n;\n\nfunction ClientPayment(_ref) {\n  _s();\n\n  let {\n    clientId,\n    debt\n  } = _ref;\n  const {\n    language\n  } = useLanguage();\n  const {\n    loggedInUser\n  } = useAuth();\n  const detailsColumns = language === 'eng' ? detailsEngColumns() : detailsTurksihColumns();\n  const [detailsRows, setDetailsRows] = useState([]);\n  const [useEffectTrigger, setUseEffectTrigger] = useState(false);\n  const [from, setFrom] = useState(new Date());\n  const date = new Date();\n  const [to, setTo] = useState(new Date(date.setHours(date.getHours() + 24)));\n  const totalReservationsCost = useRef(0);\n  const paymentTotal = useRef(0);\n  const totalsRows = useRef([{\n    id: 10000200,\n    totalReservationsCost: 0,\n    paymentTotal: 0,\n    debt: debt,\n    status: 'total'\n  }]);\n\n  const invokeUseEffect = () => {\n    setUseEffectTrigger(!useEffectTrigger);\n  };\n\n  useEffect(() => {\n    const clientId = loggedInUser.id;\n    console.log(clientId);\n    console.log(loggedInUser);\n    getMyDetailsStat(clientId, from, to).then(data => {\n      let idx = 0;\n\n      if (data.error) {\n        console.log(data.error);\n      } else if (data.success) {\n        data.success.reservations.map(reservation => {\n          reservation.id = idx + 1;\n          reservation.status = 'reservation';\n          const date = new Date(reservation.selectedDate);\n          reservation.date = format(date, \"dd-MM-yyyy kk:mm\");\n          totalReservationsCost.current += reservation.cost ? reservation.cost : 0;\n          idx++;\n        });\n        data.success.payments.map(item => {\n          var _item$client;\n\n          item.id = idx + 1;\n          item.property = (_item$client = item.client) === null || _item$client === void 0 ? void 0 : _item$client.property;\n          item.status = 'payment';\n          const date = new Date(item.createdAt ? item.createdAt : new Date());\n          item.date = format(date, \"dd-MM-yyyy kk:mm\");\n          paymentTotal.current += item.paidInTL;\n          idx++;\n        });\n        totalsRows.current[0].totalReservationsCost = totalReservationsCost.current;\n        totalsRows.current[0].paymentTotal = paymentTotal.current;\n        totalsRows.current[0].debt = totalReservationsCost.current - paymentTotal.current;\n        setDetailsRows([...data.success.reservations, ...data.success.payments, ...totalsRows.current].sort(function (a, b) {\n          return parseFloat(a.date) - parseFloat(b.date);\n        }));\n      } else {\n        console.log('External Error, please try again Later!');\n      }\n    });\n    return () => {\n      totalReservationsCost.current = 0;\n      paymentTotal.current = 0;\n      setDetailsRows([]);\n    };\n  }, [useEffectTrigger]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(Box, {\n      display: \"flex\",\n      flexDirection: \"column\",\n      children: [/*#__PURE__*/_jsxDEV(Search, {\n        from: from,\n        to: to,\n        setFrom: setFrom,\n        setTo: setTo,\n        invokeUseEffect: invokeUseEffect\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(DataTable, {\n        rows: detailsRows,\n        columns: detailsColumns\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 13\n    }, this)\n  }, void 0, false);\n}\n\n_s(ClientPayment, \"XL45UjXtcydxkMTRFzeBRZTQWMI=\", false, function () {\n  return [useLanguage, useAuth];\n});\n\n_c = ClientPayment;\nexport default ClientPayment;\n\nvar _c;\n\n$RefreshReg$(_c, \"ClientPayment\");","map":{"version":3,"sources":["/home/cisco/airport-shuttle-v2/airportShuttleV2/client/src/pages/ClientPayment/ClientPayment.tsx"],"names":["Box","useEffect","useState","useRef","DataTable","useLanguage","format","detailsEngColumns","detailsTurksihColumns","Search","getMyDetailsStat","useAuth","ClientPayment","clientId","debt","language","loggedInUser","detailsColumns","detailsRows","setDetailsRows","useEffectTrigger","setUseEffectTrigger","from","setFrom","Date","date","to","setTo","setHours","getHours","totalReservationsCost","paymentTotal","totalsRows","id","status","invokeUseEffect","console","log","then","data","idx","error","success","reservations","map","reservation","selectedDate","current","cost","payments","item","property","client","createdAt","paidInTL","sort","a","b","parseFloat"],"mappings":"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","sourcesContent":["import {  Box } from '@material-ui/core';\nimport { useEffect, useState, useRef } from 'react';\nimport DataTable from '../../components/DataTable/DataTable';\nimport { useLanguage } from '../../context/useLanguageContext';\nimport { format } from 'date-fns';\nimport { detailsEngColumns, detailsTurksihColumns } from '../../utils/dictionary';\nimport Search from '../../components/Search/Search';\nimport { getMyDetailsStat } from '../../helpers/APICalls/reservation';\nimport { useAuth } from '../../context/useAuthContext';\n\ninterface Props {\n    clientId: string;\n    debt: number;\n};\n\ninterface Total {\n    id: number;\n    totalReservationsCost?: number;\n    paymentTotal?: number;\n    currency?: string;\n    debt: number;\n    status?: string;\n}\n\nfunction ClientPayment({ clientId, debt }: Props): JSX.Element {\n    const { language } = useLanguage();\n    const { loggedInUser } = useAuth();\n    const detailsColumns = language === 'eng' ? detailsEngColumns() : detailsTurksihColumns();\n    const [detailsRows, setDetailsRows] = useState<any>([]);\n    const [useEffectTrigger, setUseEffectTrigger] = useState<boolean>(false);\n    const [from, setFrom] = useState(new Date());\n    const date = new Date();\n    const [to, setTo] = useState(new Date(date.setHours(date.getHours() + 24)));\n\n\n    const totalReservationsCost = useRef(0);\n    const paymentTotal = useRef(0);\n    const totalsRows = useRef<Total[]>([{id: 10000200, totalReservationsCost: 0, paymentTotal: 0, debt: debt, status: 'total'}]); \n\n    const invokeUseEffect = () => {\n        setUseEffectTrigger(!useEffectTrigger)\n    };\n\n    useEffect(() => {\n        const clientId = loggedInUser.id;\n        console.log(clientId)\n        console.log(loggedInUser)\n        getMyDetailsStat(clientId, from, to).then((data) => {\n                let idx = 0;\n                if (data.error) {\n                    console.log(data.error)\n                } else if (data.success) {\n                    data.success.reservations.map((reservation) => {\n                        reservation.id = idx + 1;\n                        reservation.status = 'reservation'\n                        const date = new Date(reservation.selectedDate);\n                        reservation.date = format(date, \"dd-MM-yyyy kk:mm\");\n                        totalReservationsCost.current +=  (reservation.cost ? reservation.cost : 0);\n                        idx ++;\n                        });\n                    data.success.payments.map((item) => {\n                        item.id = idx + 1;\n                        item.property = item.client?.property;\n                        item.status = 'payment'\n                        const date = new Date(item.createdAt ? item.createdAt : new Date());\n                        item.date = format(date, \"dd-MM-yyyy kk:mm\");\n                        paymentTotal.current += item.paidInTL;\n                        idx++\n                    });\n                    totalsRows.current[0].totalReservationsCost = totalReservationsCost.current;\n                    totalsRows.current[0].paymentTotal = paymentTotal.current;\n                    totalsRows.current[0].debt = totalReservationsCost.current - paymentTotal.current;  \n                    setDetailsRows([...data.success.reservations, ...data.success.payments, ...totalsRows.current]\n                    .sort(function(a, b) {return parseFloat(a.date) - parseFloat(b.date)}));                    \n                 \n                } else {\n                    console.log('External Error, please try again Later!')\n                }\n            });\n            return () => {\n                totalReservationsCost.current = 0;\n                paymentTotal.current = 0;\n                setDetailsRows([]);\n            }\n    }, [useEffectTrigger]);\n    \n    return (\n        <>  \n            <Box display='flex' flexDirection='column'>\n                <Search from={from} to={to} setFrom={setFrom} setTo={setTo} invokeUseEffect={invokeUseEffect}/>\n                <DataTable rows={detailsRows} columns={detailsColumns} />\n            </Box>\n        </>\n    )\n}\nexport default ClientPayment"]},"metadata":{},"sourceType":"module"}