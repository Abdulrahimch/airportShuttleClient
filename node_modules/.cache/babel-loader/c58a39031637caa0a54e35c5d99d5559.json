{"ast":null,"code":"import _toConsumableArray from\"/home/cisco/airportShuttleDeploy/airportShuttleV2/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/home/cisco/airportShuttleDeploy/airportShuttleV2/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{Box}from'@material-ui/core';import{useEffect,useState,useRef}from'react';import DataTable from'../../components/DataTable/DataTable';import{useLanguage}from'../../context/useLanguageContext';import{format}from'date-fns';import{detailsEngColumns,detailsTurksihColumns}from'../../utils/dictionary';import Search from'../../components/Search/Search';import{getMyDetailsStat}from'../../helpers/APICalls/reservation';import{useAuth}from'../../context/useAuthContext';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";;function ClientPayment(_ref){var clientId=_ref.clientId,debt=_ref.debt;var _useLanguage=useLanguage(),language=_useLanguage.language;var _useAuth=useAuth(),loggedInUser=_useAuth.loggedInUser;var detailsColumns=language==='eng'?detailsEngColumns():detailsTurksihColumns();var _useState=useState([]),_useState2=_slicedToArray(_useState,2),detailsRows=_useState2[0],setDetailsRows=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),useEffectTrigger=_useState4[0],setUseEffectTrigger=_useState4[1];var _useState5=useState(new Date()),_useState6=_slicedToArray(_useState5,2),from=_useState6[0],setFrom=_useState6[1];var date=new Date();var _useState7=useState(new Date(date.setHours(date.getHours()+24))),_useState8=_slicedToArray(_useState7,2),to=_useState8[0],setTo=_useState8[1];var totalReservationsCost=useRef(0);var paymentTotal=useRef(0);var totalsRows=useRef([{id:10000200,totalReservationsCost:0,paymentTotal:0,debt:debt,status:'total'}]);var invokeUseEffect=function invokeUseEffect(){setUseEffectTrigger(!useEffectTrigger);};useEffect(function(){var clientId=loggedInUser===null||loggedInUser===void 0?void 0:loggedInUser.id;getMyDetailsStat(clientId,from,to).then(function(data){var idx=0;if(data.error){console.log(data.error);}else if(data.success){data.success.reservations.map(function(reservation){reservation.id=idx+1;reservation.status='reservation';var date=new Date(reservation.selectedDate);reservation.date=format(date,\"dd-MM-yyyy kk:mm\");totalReservationsCost.current+=reservation.cost?reservation.cost:0;idx++;});data.success.payments.map(function(item){var _item$client;item.id=idx+1;item.property=(_item$client=item.client)===null||_item$client===void 0?void 0:_item$client.property;item.status='payment';var date=new Date(item.createdAt?item.createdAt:new Date());item.date=format(date,\"dd-MM-yyyy kk:mm\");paymentTotal.current+=item.paidInTL;idx++;});totalsRows.current[0].totalReservationsCost=totalReservationsCost.current;totalsRows.current[0].paymentTotal=paymentTotal.current;totalsRows.current[0].debt=totalReservationsCost.current-paymentTotal.current;setDetailsRows([].concat(_toConsumableArray(data.success.reservations),_toConsumableArray(data.success.payments),_toConsumableArray(totalsRows.current)).sort(function(a,b){return parseFloat(a.date)-parseFloat(b.date);}));}else{console.log('External Error, please try again Later!');}});return function(){totalReservationsCost.current=0;paymentTotal.current=0;setDetailsRows([]);};},[useEffectTrigger]);return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(Box,{display:\"flex\",flexDirection:\"column\",children:[/*#__PURE__*/_jsx(Search,{from:from,to:to,setFrom:setFrom,setTo:setTo,invokeUseEffect:invokeUseEffect}),/*#__PURE__*/_jsx(DataTable,{rows:detailsRows,columns:detailsColumns})]})});}export default ClientPayment;","map":{"version":3,"sources":["/home/cisco/airportShuttleDeploy/airportShuttleV2/client/src/pages/ClientPayment/ClientPayment.tsx"],"names":["Box","useEffect","useState","useRef","DataTable","useLanguage","format","detailsEngColumns","detailsTurksihColumns","Search","getMyDetailsStat","useAuth","ClientPayment","clientId","debt","language","loggedInUser","detailsColumns","detailsRows","setDetailsRows","useEffectTrigger","setUseEffectTrigger","Date","from","setFrom","date","setHours","getHours","to","setTo","totalReservationsCost","paymentTotal","totalsRows","id","status","invokeUseEffect","then","data","idx","error","console","log","success","reservations","map","reservation","selectedDate","current","cost","payments","item","property","client","createdAt","paidInTL","sort","a","b","parseFloat"],"mappings":"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","sourcesContent":["import {  Box } from '@material-ui/core';\nimport { useEffect, useState, useRef } from 'react';\nimport DataTable from '../../components/DataTable/DataTable';\nimport { useLanguage } from '../../context/useLanguageContext';\nimport { format } from 'date-fns';\nimport { detailsEngColumns, detailsTurksihColumns } from '../../utils/dictionary';\nimport Search from '../../components/Search/Search';\nimport { getMyDetailsStat } from '../../helpers/APICalls/reservation';\nimport { useAuth } from '../../context/useAuthContext';\n\ninterface Props {\n    clientId: string;\n    debt: number;\n};\n\ninterface Total {\n    id: number;\n    totalReservationsCost?: number;\n    paymentTotal?: number;\n    currency?: string;\n    debt: number;\n    status?: string;\n}\n\nfunction ClientPayment({ clientId, debt }: Props): JSX.Element {\n    const { language } = useLanguage();\n    const { loggedInUser } = useAuth();\n    const detailsColumns = language === 'eng' ? detailsEngColumns() : detailsTurksihColumns();\n    const [detailsRows, setDetailsRows] = useState<any>([]);\n    const [useEffectTrigger, setUseEffectTrigger] = useState<boolean>(false);\n    const [from, setFrom] = useState(new Date());\n    const date = new Date();\n    const [to, setTo] = useState(new Date(date.setHours(date.getHours() + 24)));\n\n\n    const totalReservationsCost = useRef(0);\n    const paymentTotal = useRef(0);\n    const totalsRows = useRef<Total[]>([{id: 10000200, totalReservationsCost: 0, paymentTotal: 0, debt: debt, status: 'total'}]); \n\n    const invokeUseEffect = () => {\n        setUseEffectTrigger(!useEffectTrigger)\n    };\n\n    useEffect(() => {\n        const clientId = loggedInUser?.id;\n        getMyDetailsStat(clientId, from, to).then((data) => {\n                let idx = 0;\n                if (data.error) {\n                    console.log(data.error)\n                } else if (data.success) {\n                    data.success.reservations.map((reservation) => {\n                        reservation.id = idx + 1;\n                        reservation.status = 'reservation'\n                        const date = new Date(reservation.selectedDate);\n                        reservation.date = format(date, \"dd-MM-yyyy kk:mm\");\n                        totalReservationsCost.current +=  (reservation.cost ? reservation.cost : 0);\n                        idx ++;\n                        });\n                    data.success.payments.map((item) => {\n                        item.id = idx + 1;\n                        item.property = item.client?.property;\n                        item.status = 'payment'\n                        const date = new Date(item.createdAt ? item.createdAt : new Date());\n                        item.date = format(date, \"dd-MM-yyyy kk:mm\");\n                        paymentTotal.current += item.paidInTL;\n                        idx++\n                    });\n                    totalsRows.current[0].totalReservationsCost = totalReservationsCost.current;\n                    totalsRows.current[0].paymentTotal = paymentTotal.current;\n                    totalsRows.current[0].debt = totalReservationsCost.current - paymentTotal.current;  \n                    setDetailsRows([...data.success.reservations, ...data.success.payments, ...totalsRows.current]\n                    .sort(function(a, b) {return parseFloat(a.date) - parseFloat(b.date)}));                    \n                 \n                } else {\n                    console.log('External Error, please try again Later!')\n                }\n            });\n            return () => {\n                totalReservationsCost.current = 0;\n                paymentTotal.current = 0;\n                setDetailsRows([]);\n            }\n    }, [useEffectTrigger]);\n    \n    return (\n        <>  \n            <Box display='flex' flexDirection='column'>\n                <Search from={from} to={to} setFrom={setFrom} setTo={setTo} invokeUseEffect={invokeUseEffect}/>\n                <DataTable rows={detailsRows} columns={detailsColumns} />\n            </Box>\n        </>\n    )\n}\nexport default ClientPayment"]},"metadata":{},"sourceType":"module"}